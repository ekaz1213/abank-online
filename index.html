<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê –ë–ê–ù–ö ‚Äî –û–Ω–ª–∞–π–Ω –±–∞–Ω–∫–∏–Ω–≥</title>
    <style>
        :root {
            --grad: linear-gradient(135deg, #ffd94d 0%, #ff5a5a 50%, #7a4cff 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --accent: #ff5a5a;
            --success: #4CAF50;
            --warning: #ff9800;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--grad);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .app {
            width: 100%;
            max-width: 1200px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
            display: flex;
            min-height: 700px;
        }
        
        .sidebar {
            width: 300px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            color: white;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-badge {
            background: white;
            color: black;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
        }
        
        .user-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .nav-btn {
            width: 100%;
            background: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .main {
            flex: 1;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            overflow-y: auto;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-section.active {
            display: block;
        }
        
        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        
        .balance {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 90, 90, 0.1);
        }
        
        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 90, 90, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π */
        .operation-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .operation-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .operation-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .operation-details {
            flex: 1;
        }

        .operation-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .operation-title {
            font-weight: 600;
            color: #333;
        }

        .operation-amount {
            font-weight: bold;
            font-size: 16px;
        }

        .operation-amount.positive {
            color: var(--success);
        }

        .operation-amount.negative {
            color: var(--accent);
        }

        .operation-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .operation-date {
            color: #999;
            font-size: 12px;
        }

        .receipt-btn {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .receipt-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* –ö–≤–∏—Ç–∞–Ω—Ü–∏–∏ */
        .receipt-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .receipt-modal.active {
            display: flex;
        }

        .receipt {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            font-family: 'Courier New', monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .receipt-header {
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .receipt-line {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 4px 0;
            border-bottom: 1px dotted #ddd;
        }

        .receipt-total {
            border-top: 2px solid #333;
            margin-top: 15px;
            padding-top: 10px;
            font-weight: bold;
            font-size: 18px;
        }

        .receipt-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .close-receipt {
            background: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
        }

        .print-receipt {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
        }

        .bonus-badge {
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .verification-badge {
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .pending-badge {
            background: var(--warning);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã */
        .transfer-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .transfer-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .transfer-option.active {
            border-color: var(--accent);
            background: rgba(255, 90, 90, 0.1);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .quick-action {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="sidebar">
            <div class="logo">
                –ê –ë–ê–ù–ö <span class="logo-badge">online</span>
            </div>
            
            <div class="user-card">
                <div id="userGreeting">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>
                <div id="userDetails">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–Ω–∫–∏–Ω–≥—É</div>
            </div>
            
            <div id="nav" style="display: none;">
                <button class="nav-btn" onclick="showSection('dashboard')">üìä –î–∞—à–±–æ—Ä–¥</button>
                <button class="nav-btn" onclick="showSection('transfer')">üí∏ –ü–µ—Ä–µ–≤–æ–¥</button>
                <button class="nav-btn" onclick="showSection('cards')">üí≥ –ö–∞—Ä—Ç—ã</button>
                <button class="nav-btn" onclick="showSection('history')">üìà –ò—Å—Ç–æ—Ä–∏—è</button>
                <button class="nav-btn" onclick="showSection('receipts')">üßæ –ö–≤–∏—Ç–∞–Ω—Ü–∏–∏</button>
                <button class="nav-btn" onclick="showSection('admin')" id="adminBtn" style="display: none;">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                <button class="nav-btn" onclick="logout()" style="background: transparent; color: white; border: 2px solid rgba(255,255,255,0.3);">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </div>
        
        <div class="main">
            <!-- –í—Ö–æ–¥ -->
            <div id="loginSection" class="content-section active">
                <div class="card">
                    <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                    <input type="email" id="loginEmail" placeholder="Email" value="admin@abank.ru">
                    <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="Admin123!">
                    <button onclick="login()">–í–æ–π—Ç–∏</button>
                    <button onclick="showSection('register')" style="background: transparent; color: #666; border: 2px solid #ddd; margin-left: 10px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
            </div>
            
            <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
            <div id="registerSection" class="content-section">
                <div class="card">
                    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è <span class="bonus-badge">+500 ‚ÇΩ –±–æ–Ω—É—Å!</span></h2>
                    <input type="text" id="regName" placeholder="–ò–º—è">
                    <input type="text" id="regLastName" placeholder="–§–∞–º–∏–ª–∏—è">
                    <input type="email" id="regEmail" placeholder="Email">
                    <input type="tel" id="regPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                    <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                    <button onclick="register()">üéÅ –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç + –ø–æ–ª—É—á–∏—Ç—å 500 ‚ÇΩ</button>
                    <button onclick="showSection('login')" style="background: transparent; color: #666; border: 2px solid #ddd; margin-left: 10px;">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
            
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="dashboardSection" class="content-section">
                <div class="card">
                    <h2 id="userWelcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                    <div class="balance" id="userBalance">0 ‚ÇΩ</div>
                    <p>–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                    
                    <div class="quick-actions">
                        <div class="quick-action" onclick="showSection('transfer')">
                            <div style="font-size: 24px;">üí∏</div>
                            <div>–ü–µ—Ä–µ–≤–æ–¥</div>
                        </div>
                        <div class="quick-action" onclick="applyCard()">
                            <div style="font-size: 24px;">üí≥</div>
                            <div>–ö–∞—Ä—Ç–∞</div>
                        </div>
                        <div class="quick-action" onclick="showSection('history')">
                            <div style="font-size: 24px;">üìà</div>
                            <div>–ò—Å—Ç–æ—Ä–∏—è</div>
                        </div>
                        <div class="quick-action" onclick="showSection('receipts')">
                            <div style="font-size: 24px;">üßæ</div>
                            <div>–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                    <div id="recentOperations">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                </div>
            </div>
            
            <!-- –ü–µ—Ä–µ–≤–æ–¥ -->
            <div id="transferSection" class="content-section">
                <div class="card">
                    <h2>–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
                    
                    <div class="transfer-options">
                        <div class="transfer-option active" onclick="setTransferType('email')">üìß Email</div>
                        <div class="transfer-option" onclick="setTransferType('phone')">üì± –¢–µ–ª–µ—Ñ–æ–Ω</div>
                        <div class="transfer-option" onclick="setTransferType('card')">üí≥ –ö–∞—Ä—Ç–∞</div>
                    </div>
                    
                    <input type="text" id="transferRecipient" placeholder="Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                    <input type="number" id="transferAmount" placeholder="–°—É–º–º–∞">
                    <input type="text" id="transferDesc" placeholder="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ">
                    <button onclick="makeTransfer()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
                </div>
            </div>
            
            <!-- –ö–∞—Ä—Ç—ã -->
            <div id="cardsSection" class="content-section">
                <div class="card">
                    <h2>–ú–æ–∏ –∫–∞—Ä—Ç—ã</h2>
                    <div id="cardsList">–ö–∞—Ä—Ç –ø–æ–∫–∞ –Ω–µ—Ç</div>
                    <button onclick="applyCard()" style="margin-top: 15px;">üí≥ –í—ã–ø—É—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            </div>
            
            <!-- –ò—Å—Ç–æ—Ä–∏—è -->
            <div id="historySection" class="content-section">
                <div class="card">
                    <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                    <input type="text" id="searchOperations" placeholder="–ü–æ–∏—Å–∫ –æ–ø–µ—Ä–∞—Ü–∏–π..." oninput="debounceSearch()">
                    <div id="operationsList">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                </div>
            </div>

            <!-- –ö–≤–∏—Ç–∞–Ω—Ü–∏–∏ -->
            <div id="receiptsSection" class="content-section">
                <div class="card">
                    <h2>üßæ –ú–æ–∏ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏</h2>
                    <div id="receiptsList">–ö–≤–∏—Ç–∞–Ω—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
            <div id="adminSection" class="content-section">
                <div class="card">
                    <h2>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                    
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
                            <div class="stat-value" id="statUsers">0</div>
                        </div>
                        <div class="stat-card">
                            <div>–û–ø–µ—Ä–∞—Ü–∏–∏</div>
                            <div class="stat-value" id="statOperations">0</div>
                        </div>
                        <div class="stat-card">
                            <div>–ë–∞–ª–∞–Ω—Å —Å–∏—Å—Ç–µ–º—ã</div>
                            <div class="stat-value" id="statBalance">0 ‚ÇΩ</div>
                        </div>
                        <div class="stat-card">
                            <div>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏</div>
                            <div class="stat-value" id="statVerifications">0</div>
                        </div>
                    </div>
                    
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                    <div class="user-list" id="adminUserList">
                        <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ -->
    <div id="receiptModal" class="receipt-modal">
        <div class="receipt" id="receiptContent">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>
    
    <div id="notificationContainer"></div>

    <script>
        // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        const cache = {
            users: null,
            operations: null,
            receipts: null
        };
        
        // –ü—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
        const DB = {
            get users() {
                if (!cache.users) {
                    cache.users = JSON.parse(localStorage.getItem('abank_users')) || [
                        {
                            id: 'admin',
                            name: '–ê–¥–º–∏–Ω',
                            lastName: '–°–∏—Å—Ç–µ–º—ã',
                            email: 'admin@abank.ru',
                            phone: '+7 (999) 000-00-00',
                            password: 'Admin123!',
                            balance: 100000,
                            role: 'admin',
                            cards: [],
                            status: 'active',
                            verified: true
                        }
                    ];
                }
                return cache.users;
            },
            
            get operations() {
                if (!cache.operations) {
                    cache.operations = JSON.parse(localStorage.getItem('abank_operations')) || [];
                }
                return cache.operations;
            },
            
            get receipts() {
                if (!cache.receipts) {
                    cache.receipts = JSON.parse(localStorage.getItem('abank_receipts')) || [];
                }
                return cache.receipts;
            },
            
            get session() {
                return JSON.parse(localStorage.getItem('abank_session')) || null;
            }
        };
        
        let currentUser = null;
        let transferType = 'email';
        let searchTimeout = null;
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('abank_users', JSON.stringify(DB.users));
            localStorage.setItem('abank_operations', JSON.stringify(DB.operations));
            localStorage.setItem('abank_receipts', JSON.stringify(DB.receipts));
            localStorage.setItem('abank_session', JSON.stringify(DB.session));
            
            // –°–±—Ä–æ—Å –∫—ç—à–∞
            cache.users = null;
            cache.operations = null;
            cache.receipts = null;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName + 'Section').classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
            if (sectionName === 'history') loadHistory();
            if (sectionName === 'receipts') loadReceipts();
            if (sectionName === 'admin') loadAdminPanel();
            if (sectionName === 'dashboard') loadDashboard();
        }
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            if (type === 'error') notification.style.background = '#ff5a5a';
            if (type === 'warning') notification.style.background = '#ff9800';
            
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // –í—Ö–æ–¥
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = DB.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                DB.session = { userId: user.id };
                saveData();
                updateUI();
                showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
            } else {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        function register() {
            const userData = {
                name: document.getElementById('regName').value,
                lastName: document.getElementById('regLastName').value,
                email: document.getElementById('regEmail').value,
                phone: document.getElementById('regPhone').value,
                password: document.getElementById('regPassword').value
            };
            
            if (DB.users.find(u => u.email === userData.email)) {
                showNotification('Email —É–∂–µ –∑–∞–Ω—è—Ç', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ–Ω—É—Å–æ–º 500 ‚ÇΩ
            const newUser = {
                id: 'user_' + Date.now(),
                ...userData,
                balance: 500,
                role: 'user',
                cards: [],
                status: 'active',
                verified: false
            };
            
            DB.users.push(newUser);
            DB.session = { userId: newUser.id };
            currentUser = newUser;
            saveData();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
            const bonusOperation = {
                id: 'op_' + Date.now(),
                type: 'welcome_bonus',
                userId: newUser.id,
                amount: 500,
                description: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é',
                at: new Date().toISOString()
            };
            
            DB.operations.push(bonusOperation);
            
            // –°–æ–∑–¥–∞–µ–º –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –¥–ª—è –±–æ–Ω—É—Å–∞
            createReceipt(bonusOperation, newUser, null);
            
            updateUI();
            showNotification('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ù–∞ –≤–∞—à —Å—á–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω –±–æ–Ω—É—Å 500 ‚ÇΩ üéÅ');
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∏–ø–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
        function setTransferType(type) {
            transferType = type;
            document.querySelectorAll('.transfer-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const input = document.getElementById('transferRecipient');
            switch(type) {
                case 'email':
                    input.placeholder = 'Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
                    break;
                case 'phone':
                    input.placeholder = '–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
                    break;
                case 'card':
                    input.placeholder = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
                    break;
            }
        }
        
        // –ü–µ—Ä–µ–≤–æ–¥
        function makeTransfer() {
            const recipientId = document.getElementById('transferRecipient').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const description = document.getElementById('transferDesc').value;
            
            let recipient;
            
            // –ü–æ–∏—Å–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ —Ä–∞–∑–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
            switch(transferType) {
                case 'email':
                    recipient = DB.users.find(u => u.email === recipientId);
                    break;
                case 'phone':
                    recipient = DB.users.find(u => u.phone === recipientId);
                    break;
                case 'card':
                    // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã
                    recipient = DB.users.find(u => 
                        u.cards.some(card => card.number.replace(/\s/g, '') === recipientId.replace(/\s/g, ''))
                    );
                    break;
            }
            
            if (!recipient) {
                showNotification('–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            if (currentUser.balance < amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥
            currentUser.balance -= amount;
            recipient.balance += amount;
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
            const transferOperation = {
                id: 'op_' + Date.now(),
                type: 'transfer',
                fromId: currentUser.id,
                toId: recipient.id,
                amount: amount,
                description: description,
                at: new Date().toISOString()
            };
            
            DB.operations.push(transferOperation);
            
            // –°–æ–∑–¥–∞–µ–º –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
            createReceipt(transferOperation, currentUser, recipient);
            
            saveData();
            updateUI();
            showNotification(`–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ ${amount} ‚ÇΩ –≤—ã–ø–æ–ª–Ω–µ–Ω!`);
            showSection('dashboard');
        }
        
        // –í—ã–ø—É—Å–∫ –∫–∞—Ä—Ç—ã
        function applyCard() {
            const cardNumber = '4276 ' + 
                Math.floor(1000 + Math.random() * 9000) + ' ' + 
                Math.floor(1000 + Math.random() * 9000) + ' ' + 
                Math.floor(1000 + Math.random() * 9000);
                
            const newCard = {
                id: 'card_' + Date.now(),
                number: cardNumber,
                type: 'Visa Classic',
                balance: currentUser.balance,
                issuedAt: new Date().toISOString()
            };
            
            currentUser.cards.push(newCard);
            
            const cardOperation = {
                id: 'op_' + Date.now(),
                type: 'card_issued',
                userId: currentUser.id,
                details: newCard,
                amount: 0,
                description: '–í—ã–ø—É—Å–∫ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã',
                at: new Date().toISOString()
            };
            
            DB.operations.push(cardOperation);
            
            // –°–æ–∑–¥–∞–µ–º –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –¥–ª—è –∫–∞—Ä—Ç—ã
            createReceipt(cardOperation, currentUser, null);
            
            saveData();
            updateUI();
            showNotification(`–ö–∞—Ä—Ç–∞ –≤—ã–ø—É—â–µ–Ω–∞: ${cardNumber}`);
            showSection('dashboard');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
        function createReceipt(operation, fromUser, toUser) {
            const receipt = {
                id: 'rec_' + Date.now(),
                operationId: operation.id,
                type: operation.type,
                amount: operation.amount,
                fromUser: fromUser,
                toUser: toUser,
                description: operation.description,
                at: operation.at,
                receiptNumber: 'R' + Date.now().toString().slice(-8)
            };
            
            DB.receipts.push(receipt);
            saveData();
            return receipt;
        }
        
        // –î–µ–±–∞—É–Ω—Å –ø–æ–∏—Å–∫–∞
        function debounceSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(loadHistory, 300);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
        function loadHistory() {
            const container = document.getElementById('operationsList');
            const searchTerm = document.getElementById('searchOperations').value.toLowerCase();
            
            if (!currentUser) return;
            
            let userOps = DB.operations.filter(op => 
                op.userId === currentUser.id || op.fromId === currentUser.id || op.toId === currentUser.id
            );
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫
            if (searchTerm) {
                userOps = userOps.filter(op => 
                    op.description.toLowerCase().includes(searchTerm) ||
                    op.amount.toString().includes(searchTerm)
                );
            }
            
            if (userOps.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">–û–ø–µ—Ä–∞—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }
            
            container.innerHTML = userOps.map(op => {
                const isOutgoing = op.fromId === currentUser.id;
                const isBonus = op.type === 'welcome_bonus';
                const isCard = op.type === 'card_issued';
                
                let icon = 'üí∏';
                let title = '–ü–µ—Ä–µ–≤–æ–¥';
                
                if (isBonus) {
                    icon = 'üéÅ';
                    title = '–ë–æ–Ω—É—Å';
                } else if (isCard) {
                    icon = 'üí≥';
                    title = '–í—ã–ø—É—Å–∫ –∫–∞—Ä—Ç—ã';
                }
                
                return `
                    <div class="operation-item">
                        <div class="operation-icon">${icon}</div>
                        <div class="operation-details">
                            <div class="operation-main">
                                <div class="operation-title">${title}</div>
                                <div class="operation-amount ${isOutgoing ? 'negative' : 'positive'}">
                                    ${isOutgoing ? '-' : '+'}${op.amount || 0} ‚ÇΩ
                                </div>
                            </div>
                            <div class="operation-description">${op.description}</div>
                            <div class="operation-date">${new Date(op.at).toLocaleString('ru-RU')}</div>
                        </div>
                        <button class="receipt-btn" onclick="showReceipt('${op.id}')">üßæ –ö–≤–∏—Ç–∞–Ω—Ü–∏—è</button>
                    </div>
                `;
            }).join('');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π
        function loadReceipts() {
            const container = document.getElementById('receiptsList');
            if (!currentUser) return;
            
            const userReceipts = DB.receipts.filter(rec => 
                rec.fromUser.id === currentUser.id || (rec.toUser && rec.toUser.id === currentUser.id)
            );
            
            if (userReceipts.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">–ö–≤–∏—Ç–∞–Ω—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }
            
            container.innerHTML = userReceipts.map(rec => {
                return `
                    <div class="operation-item">
                        <div class="operation-icon">üßæ</div>
                        <div class="operation-details">
                            <div class="operation-main">
                                <div class="operation-title">–ö–≤–∏—Ç–∞–Ω—Ü–∏—è ‚Ññ${rec.receiptNumber}</div>
                                <div class="operation-amount">${rec.amount || 0} ‚ÇΩ</div>
                            </div>
                            <div class="operation-description">${rec.description}</div>
                            <div class="operation-date">${new Date(rec.at).toLocaleString('ru-RU')}</div>
                        </div>
                        <button class="receipt-btn" onclick="showReceipt('${rec.operationId}')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                    </div>
                `;
            }).join('');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
        function loadDashboard() {
            if (!currentUser) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            const recentOps = DB.operations
                .filter(op => op.userId === currentUser.id || op.fromId === currentUser.id || op.toId === currentUser.id)
                .slice(-3)
                .reverse();
            
            const container = document.getElementById('recentOperations');
            
            if (recentOps.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }
            
            container.innerHTML = recentOps.map(op => {
                const isOutgoing = op.fromId === currentUser.id;
                return `
                    <div class="operation-item" style="margin-bottom: 10px;">
                        <div class="operation-icon">${isOutgoing ? 'üí∏' : 'üí∞'}</div>
                        <div class="operation-details">
                            <div class="operation-main">
                                <div class="operation-title">${op.description}</div>
                                <div class="operation-amount ${isOutgoing ? 'negative' : 'positive'}">
                                    ${isOutgoing ? '-' : '+'}${op.amount || 0} ‚ÇΩ
                                </div>
                            </div>
                            <div class="operation-date">${new Date(op.at).toLocaleString('ru-RU')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function loadAdminPanel() {
            if (!currentUser || currentUser.role !== 'admin') return;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('statUsers').textContent = DB.users.length;
            document.getElementById('statOperations').textContent = DB.operations.length;
            document.getElementById('statBalance').textContent = 
                DB.users.reduce((sum, user) => sum + user.balance, 0) + ' ‚ÇΩ';
            document.getElementById('statVerifications').textContent = 
                DB.users.filter(u => u.verified).length + '/' + DB.users.length;
            
            // –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const userList = document.getElementById('adminUserList');
            userList.innerHTML = DB.users.map(user => `
                <div class="user-item">
                    <div>
                        <strong>${user.name} ${user.lastName}</strong>
                        <div style="font-size: 12px; color: #666;">${user.email}</div>
                        <div>–ë–∞–ª–∞–Ω—Å: ${user.balance} ‚ÇΩ</div>
                    </div>
                    <div class="user-actions">
                        ${user.verified ? 
                            '<span class="verification-badge">‚úì –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω</span>' : 
                            '<span class="pending-badge">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>'
                        }
                        ${!user.verified ? 
                            `<button onclick="verifyUser('${user.id}')" style="padding: 5px 10px; font-size: 12px;">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å</button>` : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }
        
        // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function verifyUser(userId) {
            const user = DB.users.find(u => u.id === userId);
            if (user) {
                user.verified = true;
                saveData();
                loadAdminPanel();
                showNotification(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.name} –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω`);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
        function showReceipt(operationId) {
            const operation = DB.operations.find(op => op.id === operationId);
            const receipt = DB.receipts.find(rec => rec.operationId === operationId);
            
            if (!operation || !receipt) return;
            
            let receiptHTML = `
                <div class="receipt-header">
                    <h2>–ê –ë–ê–ù–ö</h2>
                    <div>–ö–≤–∏—Ç–∞–Ω—Ü–∏—è ‚Ññ${receipt.receiptNumber}</div>
                </div>
                
                <div class="receipt-line">
                    <span>–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏:</span>
                    <span>${new Date(operation.at).toLocaleString('ru-RU')}</span>
                </div>
                
                <div class="receipt-line">
                    <span>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:</span>
                    <span>${getOperationType(operation.type)}</span>
                </div>`;
            
            if (receipt.fromUser) {
                receiptHTML += `
                    <div class="receipt-line">
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:</span>
                        <span>${receipt.fromUser.name} ${receipt.fromUser.lastName}</span>
                    </div>`;
            }
            
            if (receipt.toUser) {
                receiptHTML += `
                    <div class="receipt-line">
                        <span>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</span>
                        <span>${receipt.toUser.name} ${receipt.toUser.lastName}</span>
                    </div>`;
            }
            
            if (operation.amount > 0) {
                receiptHTML += `
                    <div class="receipt-line">
                        <span>–°—É–º–º–∞:</span>
                        <span><strong>${operation.amount} ‚ÇΩ</strong></span>
                    </div>`;
            }
            
            receiptHTML += `
                <div class="receipt-line">
                    <span>–û–ø–∏—Å–∞–Ω–∏–µ:</span>
                    <span>${operation.description}</span>
                </div>
                
                <div class="receipt-line">
                    <span>–°—Ç–∞—Ç—É—Å:</span>
                    <span style="color: var(--success);"><strong>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</strong></span>
                </div>
                
                <div class="receipt-total">
                    <span>–ò—Ç–æ–≥–æ:</span>
                    <span>${operation.amount || 0} ‚ÇΩ</span>
                </div>
                
                <div class="receipt-actions">
                    <button class="close-receipt" onclick="closeReceipt()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button class="print-receipt" onclick="printReceipt()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                </div>
            `;
            
            document.getElementById('receiptContent').innerHTML = receiptHTML;
            document.getElementById('receiptModal').classList.add('active');
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
        function getOperationType(type) {
            const types = {
                'transfer': '–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤',
                'welcome_bonus': '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å',
                'card_issued': '–í—ã–ø—É—Å–∫ –∫–∞—Ä—Ç—ã'
            };
            return types[type] || type;
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
        function closeReceipt() {
            document.getElementById('receiptModal').classList.remove('active');
        }
        
        // –ü–µ—á–∞—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
        function printReceipt() {
            const receiptContent = document.getElementById('receiptContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>–ö–≤–∏—Ç–∞–Ω—Ü–∏—è –ê –ë–ê–ù–ö</title>
                        <style>
                            body { font-family: 'Courier New', monospace; padding: 20px; }
                            .receipt-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; }
                            .receipt-line { display: flex; justify-content: space-between; margin: 8px 0; padding: 4px 0; border-bottom: 1px dotted #000; }
                            .receipt-total { border-top: 2px solid #000; margin-top: 15px; padding-top: 10px; font-weight: bold; }
                        </style>
                    </head>
                    <body>${receiptContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // –í—ã—Ö–æ–¥
        function logout() {
            currentUser = null;
            DB.session = null;
            saveData();
            updateUI();
            showNotification('–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            const nav = document.getElementById('nav');
            const greeting = document.getElementById('userGreeting');
            const details = document.getElementById('userDetails');
            const welcome = document.getElementById('userWelcome');
            const balance = document.getElementById('userBalance');
            const adminBtn = document.getElementById('adminBtn');
            
            if (currentUser) {
                nav.style.display = 'block';
                greeting.textContent = `${currentUser.name} ${currentUser.lastName}`;
                details.textContent = currentUser.email;
                welcome.textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.name}!`;
                balance.textContent = `${currentUser.balance} ‚ÇΩ`;
                
                if (currentUser.role === 'admin') {
                    adminBtn.style.display = 'block';
                } else {
                    adminBtn.style.display = 'none';
                }
                
                showSection('dashboard');
            } else {
                nav.style.display = 'none';
                greeting.textContent = '–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É';
                details.textContent = '–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–Ω–∫–∏–Ω–≥—É';
                showSection('login');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            if (DB.session) {
                currentUser = DB.users.find(u => u.id === DB.session.userId);
            }
            updateUI();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
